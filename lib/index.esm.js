import{debounce as t,throttle as o}from"lodash-es";import e from"resize-observer-polyfill";var s=document.documentElement||document.body,i={scrollContainer:s,offsetTop:0,isDynamic:!1,onChange:function(){},onExposure:function(){}},n=function(){function n(t,e){var n=this;this.scrollContainer=s,this.scrollEventElement=window,this.anchorItemList=[],this.anchorInfoMap=new Map,this.scrollTop=0,this.clientHeight=0,this.offsetTop=0,this.isDynamic=!1,this.scrollOffsetTop=0,this.activeOffsetTop=0,this.activeAnchor="",this.resizeObserver=null,this.isExposureList=[],this.checkExposure=function(){n.scrollTop=Math.abs(n.scrollContainer.scrollTop||0);var t=[];n.anchorInfoMap.forEach((function(o,e){n.isExposure(o)&&t.push(e),n.isActive(o)&&n.activeAnchor!==e&&(n.activeAnchor=e,n.onChange(e))})),t.length&&!n.isSameContent(n.isExposureList,t)&&(n.onExposure(t),n.isExposureList=t)},e=Object.assign(i,e),this.container=t,this.scrollContainer=e.scrollContainer,this.offsetTop=e.offsetTop,this.isDynamic=e.isDynamic,this.onChange=e.onChange,this.onExposure=e.onExposure,this.container&&(this.scrollEventElement=this.scrollContainer,this.scrollContainer===s&&(this.scrollEventElement=window),this.clientHeight=this.scrollContainer.clientHeight,this.throttleCheckExposure=o(this.checkExposure,100),this.init())}return n.prototype.getAnchorItem=function(){!this.isDynamic&&this.anchorItemList.length||(this.anchorItemList=this.container.querySelectorAll("[data-anchor]")||[])},n.prototype.getAnchorItemPosition=function(){var t,o=this,e=0,s=this.scrollContainer.getBoundingClientRect().top,i=e;this.anchorItemList.forEach((function(n,r){var h=n.getBoundingClientRect();e=t?i+Math.abs(h.top-t.bottom):h.top-s,t=h,i=e+h.height,o.anchorInfoMap.set(n.dataset.anchor||""+r,{top:e+o.scrollOffsetTop,bottom:i})}))},n.prototype.restart=function(){this.destroy(),this.init()},n.prototype.init=function(){this.getAnchorItem(),this.getAnchorItemPosition(),this.checkExposure(),this.bindEvent()},n.prototype.bindEvent=function(){var o=this;this.scrollEventElement.addEventListener("scroll",this.throttleCheckExposure,{passive:!0});var s=t((function(){o.getAnchorItem(),o.getAnchorItemPosition(),o.checkExposure()}),100);this.resizeObserver=new e(s),this.resizeObserver.observe(this.container)},n.prototype.destroy=function(){this.scrollEventElement.removeEventListener("scroll",this.throttleCheckExposure),this.resizeObserver&&this.resizeObserver.unobserve(this.container)},n.prototype.scrollTo=function(t){var o,e=((null===(o=this.anchorInfoMap.get(t))||void 0===o?void 0:o.top)||0)-this.offsetTop-this.activeOffsetTop+1;this.scrollContainer.scrollTo({left:0,top:e,behavior:"smooth"})},n.prototype.isSameContent=function(t,o){return t.length===o.length&&JSON.stringify(t.sort())===JSON.stringify(o.sort())},n.prototype.isActive=function(t){return t.top<=this.scrollTop+this.offsetTop+this.activeOffsetTop&&t.bottom>=this.scrollTop-this.scrollOffsetTop},n.prototype.isExposure=function(t){return t.top<this.scrollTop+this.clientHeight+this.activeOffsetTop&&t.bottom>this.scrollTop-this.scrollOffsetTop},n.version="0.0.3",n}();export{n as default};
