!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("lodash-es"),require("resize-observer-polyfill")):"function"==typeof define&&define.amd?define(["lodash-es","resize-observer-polyfill"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).Anchor=e(t.lodashEs,t.ResizeObserver)}(this,(function(t,e){"use strict";function o(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var s=o(e),i=document.documentElement||document.body,n={scrollContainer:i,offsetTop:0,isDynamic:!1,onChange:function(){},onExposure:function(){}};return function(){function e(e,o){var s=this;this.scrollContainer=i,this.scrollEventElement=window,this.anchorItemList=[],this.anchorInfoMap=new Map,this.scrollTop=0,this.clientHeight=0,this.offsetTop=0,this.isDynamic=!1,this.scrollOffsetTop=0,this.activeOffsetTop=0,this.activeAnchor="",this.resizeObserver=null,this.isExposureList=[],this.checkExposure=function(){s.scrollTop=Math.abs(s.scrollContainer.scrollTop||0);var t=[];s.anchorInfoMap.forEach((function(e,o){s.isExposure(e)&&t.push(o),s.isActive(e)&&s.activeAnchor!==o&&(s.activeAnchor=o,s.onChange(o))})),t.length&&!s.isSameContent(s.isExposureList,t)&&(s.onExposure(t),s.isExposureList=t)},o=Object.assign(n,o),this.container=e,this.scrollContainer=o.scrollContainer,this.offsetTop=o.offsetTop,this.isDynamic=o.isDynamic,this.onChange=o.onChange,this.onExposure=o.onExposure,this.container&&(this.scrollEventElement=this.scrollContainer,this.scrollContainer===i&&(this.scrollEventElement=window),this.clientHeight=this.scrollContainer.clientHeight,this.throttleCheckExposure=t.throttle(this.checkExposure,100),this.init())}return e.prototype.getAnchorItem=function(){!this.isDynamic&&this.anchorItemList.length||(this.anchorItemList=this.container.querySelectorAll("[data-anchor]")||[])},e.prototype.getAnchorItemPosition=function(){var t,e=this,o=0,s=this.scrollContainer.getBoundingClientRect().top,i=o;this.anchorItemList.forEach((function(n,r){var h=n.getBoundingClientRect();o=t?i+Math.abs(h.top-t.bottom):h.top-s,t=h,i=o+h.height,e.anchorInfoMap.set(n.dataset.anchor||""+r,{top:o+e.scrollOffsetTop,bottom:i})}))},e.prototype.restart=function(){this.destroy(),this.init()},e.prototype.init=function(){this.getAnchorItem(),this.getAnchorItemPosition(),this.checkExposure(),this.bindEvent()},e.prototype.bindEvent=function(){var e=this;this.scrollEventElement.addEventListener("scroll",this.throttleCheckExposure,{passive:!0});var o=t.debounce((function(){e.getAnchorItem(),e.getAnchorItemPosition(),e.checkExposure()}),100);this.resizeObserver=new s.default(o),this.resizeObserver.observe(this.container)},e.prototype.destroy=function(){this.scrollEventElement.removeEventListener("scroll",this.throttleCheckExposure),this.resizeObserver&&this.resizeObserver.unobserve(this.container)},e.prototype.scrollTo=function(t){var e,o=((null===(e=this.anchorInfoMap.get(t))||void 0===e?void 0:e.top)||0)-this.offsetTop-this.activeOffsetTop+1;this.scrollContainer.scrollTo({left:0,top:o,behavior:"smooth"})},e.prototype.isSameContent=function(t,e){return t.length===e.length&&JSON.stringify(t.sort())===JSON.stringify(e.sort())},e.prototype.isActive=function(t){return t.top<=this.scrollTop+this.offsetTop+this.activeOffsetTop&&t.bottom>=this.scrollTop-this.scrollOffsetTop},e.prototype.isExposure=function(t){return t.top<this.scrollTop+this.clientHeight+this.activeOffsetTop&&t.bottom>this.scrollTop-this.scrollOffsetTop},e.version="0.0.3",e}()}));
